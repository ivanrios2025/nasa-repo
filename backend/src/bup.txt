import fastify from "fastify";
import type { FastifyInstance, FastifyRequest, FastifyReply } from "fastify";
import fetch from 'node-fetch'

const app: FastifyInstance = fastify();

app.get('/', async (request: FastifyRequest, reply: FastifyReply) => {
        try {
            // Replace with your target API URL
            const apiUrl = `https://api.nasa.gov/neo/rest/v1/feed?start_date=START_DATE&end_date=END_DATE&api_key=API_KEY`; 
            
            // Make the HTTP request to the external API
            const response = await fetch(apiUrl);

            // Check if the response was successful
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            // Parse the JSON data from the response
            const data = await response.json();

            // Send the retrieved data back to the client
            reply.send(data);
        } catch (error) {
            console.error('Error fetching data:', error);
            reply.status(500).send({ error: 'Failed to fetch data from external API' });
        }
    });

const start = async () => {
  try {
    await app.listen({ port: 3000 });
    app.log.info(`Server listening on http://localhost:3000`);
  } catch (err) {
    app.log.error(err);
    process.exit(1);
  }
};

start();